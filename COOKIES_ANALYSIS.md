# –ê–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç—ã parser_cls.py –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ cookies.json

## üìã –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã `parser_cls.py` –∫–æ–≥–¥–∞ —Ñ–∞–π–ª `cookies.json` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ.

## üîç –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å cookies

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–µ—Ä–∞ (`__init__`)
```python
self.cookies = None  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ None –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
```

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies (`load_cookies`)
```python
def load_cookies(self) -> None:
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç cookies –∏–∑ JSON-—Ñ–∞–π–ª–∞ –≤ requests.Session."""
    try:
        with open("cookies.json", "r") as f:
            cookies = json.load(f)
            jar = RequestsCookieJar()
            for k, v in cookies.items():
                jar.set(k, v)
            self.session.cookies.update(jar)
    except FileNotFoundError:
        pass  # ‚ö†Ô∏è –ö–õ–Æ–ß–ï–í–û–ô –ú–û–ú–ï–ù–¢: –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
```

### 3. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ cookies.json

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. ‚úÖ `load_cookies()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ (FileNotFoundError –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è)
2. ‚úÖ `self.session.cookies` –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç—ã–º
3. ‚úÖ `self.cookies` –æ—Å—Ç–∞–µ—Ç—Å—è `None`
4. ‚ö†Ô∏è –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å `cookies=None`

### 4. –ü–µ—Ä–≤—ã–π HTTP-–∑–∞–ø—Ä–æ—Å –±–µ–∑ cookies

```python
response = self.session.get(
    url=url,
    headers=HEADERS,
    proxies=proxy_data,
    cookies=self.cookies,  # <- None –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ cookies.json
    timeout=30,
    verify=False,
    allow_redirects=True
)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ë–ï–ó cookies
- –°–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å —Å –æ—à–∏–±–∫–∞–º–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (403, 429 –∏ —Ç.–¥.)
- –ü–∞—Ä—Å–µ—Ä –º–æ–∂–µ—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ –∫–∞–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É IP

## üö® –ü—Ä–æ–±–ª–µ–º—ã –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

### 1. –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –ê–≤–∏—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ cookies –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- –ó–∞–ø—Ä–æ—Å—ã –±–µ–∑ cookies –≤—ã–≥–ª—è–¥—è—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è 403/429 –æ—Ç–≤–µ—Ç–æ–≤

### 2. –ò–∑–ª–∏—à–Ω–∏–µ —Å–º–µ–Ω—ã IP
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ 403/429 –ø–∞—Ä—Å–µ—Ä –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ –º–µ–Ω—è–µ—Ç IP
- –ù–æ –ø—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ cookies, –∞ –Ω–µ –≤ IP
- –¢—Ä–∞—Ç–∞ –ª–∏–º–∏—Ç–æ–≤ –Ω–∞ —Å–º–µ–Ω—É IP

### 3. –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- –ü–∞—Ä—Å–µ—Ä –º–æ–∂–µ—Ç –∑–∞—Å—Ç—Ä—è—Ç—å –≤ —Ü–∏–∫–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—à–∏–±–æ–∫
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –±–µ–∑ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–∞–ª–∏–¥–Ω—ã—Ö cookies

## üîß –¢–µ–∫—É—â–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ cookies
–ü–∞—Ä—Å–µ—Ä –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å cookies –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ª—É—á–∞—è—Ö:

1. **–ü—Ä–∏ —Å–º–µ–Ω–µ IP** (–≤ –º–µ—Ç–æ–¥–µ `change_ip`):
```python
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º cookies —Å –Ω–æ–≤—ã–º IP
logger.info("üç™ –û–±–Ω–æ–≤–ª—è—é cookies —Å –Ω–æ–≤—ã–º IP...")
self.cookies = self.get_cookies(max_retries=2)
```

2. **–ü—Ä–∏ —Ä–æ—Ç–∞—Ü–∏–∏ –ø—Ä–æ–∫—Å–∏**:
```python
# –û–±–Ω–æ–≤–ª—è–µ–º cookies –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–∫—Å–∏
self.cookies = self.get_cookies(max_retries=2)
```

3. **–ü—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö** (–≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –∫–æ–¥–∞):
```python
self.cookies = self.get_cookies(max_retries=2)
```

### –ú–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è cookies (`get_cookies`)
```python
def get_cookies(self, max_retries: int = 5, delay: float = 2.0) -> dict | None:
    for attempt in range(1, max_retries + 1):
        try:
            # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ cookies —á–µ—Ä–µ–∑ Playwright
            cookies = asyncio.run(get_cookies(proxy=self.proxy_obj, headless=True))
            if cookies and isinstance(cookies, dict) and len(cookies) > 0:
                logger.info(f"[get_cookies] –£—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã cookies —Å –ø–æ–ø—ã—Ç–∫–∏ {attempt}")
                return cookies
            else:
                raise ValueError("–ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç cookies –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç")
        except Exception as e:
            logger.warning(f"[get_cookies] –ü–æ–ø—ã—Ç–∫–∞ {attempt} –Ω–µ —É–¥–∞–ª–∞—Å—å: {e}")
            if attempt < max_retries:
                time.sleep(delay * attempt)
            else:
                logger.error(f"[get_cookies] –í—Å–µ {max_retries} –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ —É–¥–∞–ª–∏—Å—å")
                return None
```

## ‚úÖ –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π –±–µ–∑ cookies.json:

1. **–ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞** ‚Üí `self.cookies = None`
2. **load_cookies()** ‚Üí FileNotFoundError –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
3. **–ü–µ—Ä–≤—ã–π fetch_data()** ‚Üí –∑–∞–ø—Ä–æ—Å —Å `cookies=None`
4. **–í–æ–∑–º–æ–∂–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞** ‚Üí —Å—Ç–∞—Ç—É—Å 403/429
5. **–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è** ‚Üí —Å–º–µ–Ω–∞ IP + –ø–æ–ª—É—á–µ–Ω–∏–µ cookies
6. **–ü–æ–ª—É—á–µ–Ω–∏–µ cookies** ‚Üí —á–µ—Ä–µ–∑ Playwright —Å –±—Ä–∞—É–∑–µ—Ä–æ–º
7. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å** ‚Üí —É–∂–µ —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ cookies
8. **save_cookies()** ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ cookies.json

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:
- –ü–∞—Ä—Å–µ—Ä **–°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û** –ø–æ–ª—É—á–∞–µ—Ç cookies –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
- –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è cookies —Ä–∞–±–æ—Ç–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
- cookies.json —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üéØ –í—ã–≤–æ–¥—ã

### ‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:
1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** - –ø–∞—Ä—Å–µ—Ä –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å cookies —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ
2. **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** - FileNotFoundError –Ω–µ –∫—Ä–∞—à–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ  
3. **–°–∞–º–æ–∏—Å—Ü–µ–ª–µ–Ω–∏–µ** - cookies.json —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π —Ä–∞–±–æ—Ç–µ

### ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏** - –ø–µ—Ä–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º
2. **–¢—Ä–∞—Ç–∞ —Ä–µ—Å—É—Ä—Å–æ–≤** - –∏–∑–ª–∏—à–Ω–∏–µ —Å–º–µ–Ω—ã IP –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è cookies
3. **–ó–∞–¥–µ—Ä–∂–∫–∏** - –≤—Ä–µ–º—è –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ cookies —á–µ—Ä–µ–∑ Playwright

### üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
–ü–∞—Ä—Å–µ—Ä **—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω** –¥–∞–∂–µ –±–µ–∑ cookies.json, –Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ª—É—á—à–µ:
1. –û–±–µ—Å–ø–µ—á–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤–∞–ª–∏–¥–Ω–æ–≥–æ cookies.json –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
2. –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ cookies –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø–∞—Ä—Å–µ—Ä–∞

## üìä –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

**–°—Ç–∞—Ç—É—Å: ‚úÖ –†–ê–ë–û–¢–û–°–ü–û–°–û–ë–ï–ù**

–ü–∞—Ä—Å–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ cookies.json –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –ø–æ–ª—É—á–µ–Ω–∏—è cookies.
